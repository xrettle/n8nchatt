var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,s,r,a,i){var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof n[a]&&n[a],c=o.cache||{},l="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(e,s){if(!c[e]){if(!t[e]){var r="function"==typeof n[a]&&n[a];if(!s&&r)return r(e,!0);if(o)return o(e,!0);if(l&&"string"==typeof e)return l(e);var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}p.resolve=function(s){var r=t[e][1][s];return null!=r?r:s},p.cache={};var h=c[e]=new u.Module(e);t[e][0].call(h.exports,p,h,h.exports,this)}return c[e].exports;function p(e){var t=p.resolve(e);return!1===t?{}:u(t)}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=t,u.cache=c,u.parent=o,u.register=function(e,s){t[e]=[function(e,t){t.exports=s},{}]},Object.defineProperty(u,"root",{get:function(){return n[a]}}),n[a]=u;for(var h=0;h<s.length;h++)u(s[h]);if(r){var p=u(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=p:"function"==typeof e&&e.amd?e(function(){return p}):i&&(this[i]=p)}}({cjnrU:[function(e,t,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"userState",()=>l);var a=e("@plasmohq/storage"),i=e("../api/client"),n=e("../auth/tokenStorage");let o=(e,...t)=>{},c={isLoggedIn:!1,userId:null,email:null,creditBalance:0,hasSubscription:!1,subscriptionTier:null,subscriptionId:null,subscriptionEndsAt:null,isSubscriptionActive:!1,willCancelAtPeriodEnd:!1,isPremium:!1,planName:null,lastUpdated:0,subscriptionCheckTime:0},l=new class{constructor(){this.stateKey="n8nChatUserState",this.storage=new a.Storage({area:"local"}),this.listeners=[],this.refreshInterval=null,this.isRefreshing=!1,this.lastRefreshAttempt=0,this.refreshUserState=this.refreshUserState.bind(this)}async getState(){let e=await this.storage.get(this.stateKey);return e?{...c,...e}:c}async setState(e){let t=await this.getState(),s={...t,...e,lastUpdated:Date.now()};return await this.storage.set(this.stateKey,s),this.notifyListeners(s),s}async resetState(){let e={...c,lastUpdated:Date.now()};return await this.storage.set(this.stateKey,e),await (0,n.TokenStorage).clearTokens(),this.notifyListeners(e),e}async clearSubscriptionCache(){let e=await this.getState();await this.setState({...e,subscriptionCheckTime:0}),console.log("Subscription cache cleared")}subscribe(e){return this.listeners.push(e),this.getState().then(e),()=>{this.listeners=this.listeners.filter(t=>t!==e)}}notifyListeners(e){[...this.listeners].forEach(t=>{try{t(e)}catch(e){console.error("Error in UserStateManager listener:",e)}})}async initialize(){let e=await this.getState(),t=Date.now();(!e.lastUpdated||t-e.lastUpdated>864e5)&&await this.refreshUserState()}destroy(){this.listeners=[]}isCacheStale(e,t=864e5){let s=Date.now();return!e.lastUpdated||s-e.lastUpdated>t}async verifyFeatureAccess(e,t=!0){if("basic"===e)return{hasAccess:!0};let s=await this.getState(),r=Date.now();if(!s.isLoggedIn)return{hasAccess:!1,reason:"login-required"};if("premium"===e){let e=!s.subscriptionCheckTime||r-s.subscriptionCheckTime>36e5;if(e)try{let e=await (0,i.api).getSubscriptionStatus();if(e.success&&e.data){await this.setState({hasSubscription:!!e.data.hasActiveSubscription,isSubscriptionActive:!!e.data.hasActiveSubscription,isPremium:this.determinePremiumStatus(e.data.subscription),subscriptionCheckTime:r});let t=await this.getState(),s=t.isLoggedIn&&t.hasSubscription&&t.isSubscriptionActive&&t.isPremium;if(!s){if(!t.isLoggedIn)return{hasAccess:s,reason:"login-required"};if(!t.hasSubscription||!t.isSubscriptionActive)return{hasAccess:s,reason:"subscription-required"};if(!t.isPremium)return{hasAccess:s,reason:"premium-required"};return{hasAccess:s,reason:"subscription-required"}}return{hasAccess:s}}await this.refreshUserState()}catch(e){await this.refreshUserState()}let t=await this.getState(),a=t.isLoggedIn&&t.hasSubscription&&t.isSubscriptionActive&&t.isPremium;return a?{hasAccess:a}:t.isLoggedIn?t.hasSubscription&&t.isSubscriptionActive?t.isPremium?{hasAccess:a,reason:"subscription-required"}:{hasAccess:a,reason:"premium-required"}:{hasAccess:a,reason:"subscription-required"}:{hasAccess:a,reason:"login-required"}}if(!s.isLoggedIn)return{hasAccess:!1,reason:"login-required"};if(!s.lastUpdated||r-s.lastUpdated>36e5)return await this.refreshUserState(),this.verifyFeatureAccess(e,!1);let a=s.isLoggedIn&&s.hasSubscription&&s.isSubscriptionActive;return a?{hasAccess:a}:s.isLoggedIn?{hasAccess:a,reason:"subscription-required"}:{hasAccess:a,reason:"login-required"}}async refreshUserState(){if(this.isRefreshing)return o("Already refreshing, skipping duplicate refresh"),this.getState();let e=Date.now();if(this.lastRefreshAttempt&&e-this.lastRefreshAttempt<5e3)return o("Recent refresh attempt detected, skipping to prevent rapid refreshes"),this.getState();this.isRefreshing=!0,this.lastRefreshAttempt=e;let{accessToken:t}=await (0,n.TokenStorage).getTokens();if(!t)return this.isRefreshing=!1,this.resetState();try{let e=await this.getState(),t=Date.now(),s=!e.subscriptionCheckTime||t-e.subscriptionCheckTime>216e5,r=e.userId,a=e.email,n=e.creditBalance||0,o=!1,c=!1,l=null,u=null,h=null,p=!1;if(s)try{let e=await (0,i.api).getSubscriptionStatus();if(e.success&&e.data){let t=e.data;t.user&&(r=t.user.id,a=t.user.email,n=t.user.creditBalance||0),o=!!t.hasActiveSubscription;let s=t.subscription?.plan;s?(c=o&&!s.isBasic,u=s.name||(c?"Premium":"Basic")):(c=!1,u=o?"Basic":null)}else{let e=await (0,i.api).getCurrentUser();if(!e.success){if(401===e.status)return console.warn("Got 401 after token refresh attempt, user needs to re-login"),this.isRefreshing=!1,this.resetState();return console.warn(`API call failed with status ${e.status}, keeping current state`),this.isRefreshing=!1,this.getState()}if(!e.data?.user)return this.isRefreshing=!1,this.resetState();if(r=e.data.user.id,a=e.data.user.email,n=e.data.user.creditBalance||0,e.data.subscription){let t=e.data.subscription;o=!!t&&"active"===t.status,c=t&&t.plan&&!t.plan.isBasic,u=t?.plan?.name||(c?"Premium":o?"Basic":null)}else void 0!==e.data.hasActiveSubscription&&(o=!!e.data.hasActiveSubscription,c=!1,u=o?"Basic":null)}}catch(s){let e=await (0,i.api).getCurrentUser();if(!e.success){if(401===e.status)return console.warn("Got 401 after token refresh attempt, user needs to re-login"),this.isRefreshing=!1,this.resetState();return console.warn(`API call failed with status ${e.status}, keeping current state`),this.isRefreshing=!1,this.getState()}let{user:t}=e.data||{};if(!t)return this.isRefreshing=!1,this.resetState();r=t.id,a=t.email,n=t.creditBalance||0}else if(o=e.isSubscriptionActive,c=e.isPremium,l=e.subscriptionId,u=e.planName,h=e.subscriptionEndsAt,p=e.willCancelAtPeriodEnd,!r||!a){let e=await (0,i.api).getCurrentUser();if(e.success&&e.data?.user)r=e.data.user.id,a=e.data.user.email,n=e.data.user.creditBalance||0;else if(401===e.status)return console.warn("Got 401 after token refresh attempt, user needs to re-login"),this.isRefreshing=!1,this.resetState()}let d=c?"premium":o?"basic":null,f=await this.setState({isLoggedIn:!0,userId:r,email:a,creditBalance:n,hasSubscription:o,subscriptionTier:d,subscriptionId:l,subscriptionEndsAt:h,isSubscriptionActive:o,willCancelAtPeriodEnd:p,isPremium:c,planName:u,lastUpdated:t,...s?{subscriptionCheckTime:t}:{}});return this.isRefreshing=!1,f}catch(e){return this.isRefreshing=!1,this.getState()}}async forceSubscriptionRefresh(){let e=Date.now(),t=await this.getState();try{let s=await (0,i.api).getSubscriptionStatus();if(s.success&&s.data){let r=s.data.user,a=!!s.data.hasActiveSubscription,i=s.data.subscription?.plan,n=a&&i&&!i.isBasic,o=i?.name||(n?"Premium":a?"Basic":null);return await this.setState({...r?{userId:r.id,email:r.email,creditBalance:r.creditBalance||t.creditBalance}:{userId:t.userId,email:t.email},hasSubscription:a,isSubscriptionActive:a,isPremium:n,subscriptionTier:n?"premium":a?"basic":null,planName:o,subscriptionId:s.data.subscription?.planId||null,lastUpdated:e,subscriptionCheckTime:e}),this.getState()}let r=await (0,i.api).getCurrentUser();if(r.success&&r.data?.user){let t=r.data,s=!1,a=!1,i=null;return t.subscription?(s=!!t.subscription&&"active"===t.subscription.status,a=t.subscription&&t.subscription.plan&&!t.subscription.plan.isBasic,i=t.subscription?.plan?.name||(a?"Premium":s?"Basic":null)):void 0!==t.hasActiveSubscription&&(s=!!t.hasActiveSubscription,a=!1,i=s?"Basic":null),await this.setState({userId:t.user.id,email:t.user.email,creditBalance:t.user.creditBalance||0,hasSubscription:s,isSubscriptionActive:s,isPremium:a,subscriptionTier:a?"premium":s?"basic":null,planName:i,lastUpdated:e,subscriptionCheckTime:e}),this.getState()}}catch(e){}return await this.clearSubscriptionCache(),this.refreshUserState()}determinePremiumStatus(e){return!!e&&(!!e.plan&&!1===e.plan.isBasic||e.plan?.tier==="premium"||"premium"===e.tier)}}},{"@plasmohq/storage":"luF8G","../api/client":"kward","../auth/tokenStorage":"95fXr","@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],luF8G:[function(e,t,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"BaseStorage",()=>o),r.export(s,"Storage",()=>c);var a=e("pify"),i=r.interopDefault(a),n=()=>{try{let e=globalThis.navigator?.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===e[1])return 100>parseInt(e[2])||globalThis.chrome.runtime?.getManifest()?.manifest_version===2}catch{}return!1},o=class{#e;#t;get primaryClient(){return this.#t}#s;get secondaryClient(){return this.#s}#r;get area(){return this.#r}get hasWebApi(){try{return"u">typeof window&&!!window.localStorage}catch(e){return console.error(e),!1}}#a=new Map;#i;get copiedKeySet(){return this.#i}isCopied=e=>this.hasWebApi&&(this.allCopied||this.copiedKeySet.has(e));#n=!1;get allCopied(){return this.#n}getExtStorageApi=()=>globalThis.browser?.storage||globalThis.chrome?.storage;get hasExtensionApi(){try{return!!this.getExtStorageApi()}catch(e){return console.error(e),!1}}isWatchSupported=()=>this.hasExtensionApi;keyNamespace="";isValidKey=e=>e.startsWith(this.keyNamespace);getNamespacedKey=e=>`${this.keyNamespace}${e}`;getUnnamespacedKey=e=>e.slice(this.keyNamespace.length);serde={serializer:JSON.stringify,deserializer:JSON.parse};constructor({area:e="sync",allCopied:t=!1,copiedKeyList:s=[],serde:r={}}={}){this.setCopiedKeySet(s),this.#r=e,this.#n=t,this.serde={...this.serde,...r};try{this.hasWebApi&&(t||s.length>0)&&(this.#s=window.localStorage)}catch{}try{this.hasExtensionApi&&(this.#e=this.getExtStorageApi(),n()?this.#t=(0,i.default)(this.#e[this.area],{exclude:["getBytesInUse"],errorFirst:!1}):this.#t=this.#e[this.area])}catch{}}setCopiedKeySet(e){this.#i=new Set(e)}rawGetAll=()=>this.#t?.get();getAll=async()=>Object.entries(await this.rawGetAll()).filter(([e])=>this.isValidKey(e)).reduce((e,[t,s])=>(e[this.getUnnamespacedKey(t)]=s,e),{});copy=async e=>{let t=void 0===e;if(!t&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let s=this.allCopied?await this.rawGetAll():await this.#t.get((t?[...this.copiedKeySet]:[e]).map(this.getNamespacedKey));if(!s)return!1;let r=!1;for(let e in s){let t=s[e],a=this.#s?.getItem(e);this.#s?.setItem(e,t),r||=t!==a}return r};rawGet=async e=>(await this.rawGetMany([e]))[e];rawGetMany=async e=>this.hasExtensionApi?await this.#t.get(e):e.filter(this.isCopied).reduce((e,t)=>(e[t]=this.#s?.getItem(t),e),{});rawSet=async(e,t)=>await this.rawSetMany({[e]:t});rawSetMany=async e=>(this.#s&&Object.entries(e).filter(([e])=>this.isCopied(e)).forEach(([e,t])=>this.#s.setItem(e,t)),this.hasExtensionApi&&await this.#t.set(e),null);clear=async(e=!1)=>{e&&this.#s?.clear(),await this.#t.clear()};rawRemove=async e=>{await this.rawRemoveMany([e])};rawRemoveMany=async e=>{this.#s&&e.filter(this.isCopied).forEach(e=>this.#s.removeItem(e)),this.hasExtensionApi&&await this.#t.remove(e)};removeAll=async()=>{let e=Object.keys(await this.getAll());await this.removeMany(e)};watch=e=>{let t=this.isWatchSupported();return t&&this.#o(e),t};#o=e=>{for(let t in e){let s=this.getNamespacedKey(t),r=this.#a.get(s)?.callbackSet||new Set;if(r.add(e[t]),r.size>1)continue;let a=(e,t)=>{if(t!==this.area||!e[s])return;let r=this.#a.get(s);if(!r)throw Error(`Storage comms does not exist for nsKey: ${s}`);Promise.all([this.parseValue(e[s].newValue),this.parseValue(e[s].oldValue)]).then(([e,s])=>{for(let a of r.callbackSet)a({newValue:e,oldValue:s},t)})};this.#e.onChanged.addListener(a),this.#a.set(s,{callbackSet:r,listener:a})}};unwatch=e=>{let t=this.isWatchSupported();return t&&this.#c(e),t};#c(e){for(let t in e){let s=this.getNamespacedKey(t),r=e[t],a=this.#a.get(s);a&&(a.callbackSet.delete(r),0===a.callbackSet.size&&(this.#a.delete(s),this.#e.onChanged.removeListener(a.listener)))}}unwatchAll=()=>this.#l();#l(){this.#a.forEach(({listener:e})=>this.#e.onChanged.removeListener(e)),this.#a.clear()}async getItem(e){return this.get(e)}async getItems(e){return await this.getMany(e)}async setItem(e,t){await this.set(e,t)}async setItems(e){await await this.setMany(e)}async removeItem(e){return this.remove(e)}async removeItems(e){return await this.removeMany(e)}},c=class extends o{get=async e=>{let t=this.getNamespacedKey(e),s=await this.rawGet(t);return this.parseValue(s)};getMany=async e=>{let t=e.map(this.getNamespacedKey),s=await this.rawGetMany(t),r=await Promise.all(Object.values(s).map(this.parseValue));return Object.keys(s).reduce((e,t,s)=>(e[this.getUnnamespacedKey(t)]=r[s],e),{})};set=async(e,t)=>{let s=this.getNamespacedKey(e),r=this.serde.serializer(t);return this.rawSet(s,r)};setMany=async e=>{let t=Object.entries(e).reduce((e,[t,s])=>(e[this.getNamespacedKey(t)]=this.serde.serializer(s),e),{});return await this.rawSetMany(t)};remove=async e=>{let t=this.getNamespacedKey(e);return this.rawRemove(t)};removeMany=async e=>{let t=e.map(this.getNamespacedKey);return await this.rawRemoveMany(t)};setNamespace=e=>{this.keyNamespace=e};parseValue=async e=>{try{if(void 0!==e)return this.serde.deserializer(e)}catch(e){console.error(e)}}}},{pify:"9arDK","@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],"9arDK":[function(e,t,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"default",()=>n);let a=(e,t,s,r)=>function(...a){let i=t.promiseModule;return new i((i,n)=>{t.multiArgs?a.push((...e)=>{t.errorFirst?e[0]?n(e):(e.shift(),i(e)):i(e)}):t.errorFirst?a.push((e,t)=>{e?n(e):i(t)}):a.push(i),Reflect.apply(e,this===s?r:this,a)})},i=new WeakMap;function n(e,t){t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};let s=typeof e;if(!(null!==e&&("object"===s||"function"===s)))throw TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${null===e?"null":s}\``);let r=(e,s)=>{let r=i.get(e);if(r||(r={},i.set(e,r)),s in r)return r[s];let a=e=>"string"==typeof e||"symbol"==typeof s?s===e:e.test(s),n=Reflect.getOwnPropertyDescriptor(e,s),o=void 0===n||n.writable||n.configurable,c=t.include?t.include.some(e=>a(e)):!t.exclude.some(e=>a(e)),l=c&&o;return r[s]=l,l},n=new WeakMap,o=new Proxy(e,{apply(e,s,r){let i=n.get(e);if(i)return Reflect.apply(i,s,r);let c=t.excludeMain?e:a(e,t,o,e);return n.set(e,c),Reflect.apply(c,s,r)},get(e,s){let i=e[s];if(!r(e,s)||i===Function.prototype[s])return i;let c=n.get(i);if(c)return c;if("function"==typeof i){let s=a(i,t,o,e);return n.set(i,s),s}return i}});return o}},{"@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],hbR2Q:[function(e,t,s){s.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},s.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.exportAll=function(e,t){return Object.keys(e).forEach(function(s){"default"===s||"__esModule"===s||t.hasOwnProperty(s)||Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[s]}})}),t},s.export=function(e,t,s){Object.defineProperty(e,t,{enumerable:!0,get:s})}},{}],kward:[function(e,t,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"api",()=>o);var a=e("../constants"),i=e("../auth/tokenStorage"),n=e("@plasmohq/storage");let o=new class{constructor(e){this.baseUrl=e}async getAuthToken(){let{accessToken:e,refreshToken:t,tokenTimestamp:s}=await (0,i.TokenStorage).getTokens();if(e&&!(0,i.TokenStorage).isTokenExpired(s))return e;if(t)try{let e=await fetch(`${this.baseUrl}/auth/refresh-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:t})});if(!e.ok)return console.error(`Token refresh failed with status: ${e.status}`),await (0,i.TokenStorage).clearTokens(),null;let s=e.headers.get("content-type");if(!s||!s.includes("application/json"))return console.error("Token refresh response was not JSON."),await (0,i.TokenStorage).clearTokens(),null;let r=await e.json();if(r.success&&r.data?.token&&r.data?.refreshToken)return await (0,i.TokenStorage).setTokens(r.data.token,r.data.refreshToken),r.data.token;console.warn("Refresh token invalid or missing data in response:",r.message),await (0,i.TokenStorage).clearTokens()}catch(e){console.error("Token refresh failed:",e),await (0,i.TokenStorage).clearTokens()}return null}async request(e,t={}){let s=`${this.baseUrl}${e}`,r={"Content-Type":"application/json",...t.headers};if(!e.includes("/auth/login")&&!e.includes("/auth/register")){let e=await this.getAuthToken();e&&(r.Authorization=`Bearer ${e}`)}try{let a=await fetch(s,{...t,headers:r}),n=null,o="Unknown error",c=a.headers.get("content-type");try{c&&c.includes("application/json")?(n=await a.json(),o=n?.message||a.statusText||"Unknown error"):o=`Received non-JSON response (status ${a.status}): ${await a.text()}`}catch(t){console.error(`API request to ${e} failed during JSON parsing:`,t),o="Failed to parse server response."}if(401===a.status&&!e.includes("/auth/login")&&!e.includes("/auth/register")&&!e.includes("/auth/refresh-token")){console.log(`Got 401 for ${e}, attempting to refresh token and retry...`);let{refreshToken:a}=await (0,i.TokenStorage).getTokens();if(a)try{let n=await fetch(`${this.baseUrl}/auth/refresh-token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:a})});if(n.ok){let a=await n.json();if(a.success&&a.data?.token&&a.data?.refreshToken){await (0,i.TokenStorage).setTokens(a.data.token,a.data.refreshToken),r.Authorization=`Bearer ${a.data.token}`;let n=await fetch(s,{...t,headers:r}),o=null,c="Unknown error",l=n.headers.get("content-type");try{l&&l.includes("application/json")?(o=await n.json(),c=o?.message||n.statusText||"Unknown error"):c=`Received non-JSON response (status ${n.status}): ${await n.text()}`}catch(t){console.error(`Retry request to ${e} failed during JSON parsing:`,t),c="Failed to parse server response."}if(!n.ok)return{success:!1,status:n.status,message:c,data:o};return{success:!0,status:n.status,message:o?.message||"",data:o?.data}}}console.warn("Token refresh failed, clearing tokens"),await (0,i.TokenStorage).clearTokens()}catch(e){console.error("Token refresh error:",e),await (0,i.TokenStorage).clearTokens()}}if(!a.ok)return{success:!1,status:a.status,message:o,data:n};return{success:!0,status:a.status,message:n?.message||"",data:n?.data}}catch(s){console.error(`API request to ${e} failed:`,s);let t=s instanceof Error?s.message:String(s);return{success:!1,status:0,message:t,data:null}}}async register(e,t){return this.request("/auth/register",{method:"POST",body:JSON.stringify({email:e,password:t})})}async login(e,t){let s=await this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});return s.success&&s.data?.token&&s.data?.refreshToken&&await (0,i.TokenStorage).setTokens(s.data.token,s.data.refreshToken),s}async getCurrentUser(){return this.request("/auth/me")}async getSubscriptionStatus(){return this.request("/auth/subscription-status")}async logout(){let t;let{refreshToken:s}=await (0,i.TokenStorage).getTokens();t=s?this.request("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:s})}):Promise.resolve({success:!0,status:200,message:"Logged out locally.",data:null});let r=await t;await (0,i.TokenStorage).clearTokens();let{userState:a}=await e("7383d526c0d9cb98");return await a.resetState(),r}async getPlans(){return this.request("/subscriptions/plans")}async getCurrentSubscription(){return this.request("/subscriptions/current")}async createSubscriptionCheckout(e){return this.request("/subscriptions/checkout",{method:"POST",body:JSON.stringify({planId:e})})}async cancelSubscription(){return this.request("/subscriptions/cancel",{method:"POST"})}async requestLoginLink(t){let s=new n.Storage({area:"local"}),r=await s.get("n8nChatExtId");if(!r){let{v4:t}=await e("ea5d11c2ce00cba3");r=t(),await s.set("n8nChatExtId",r)}return this.request("/auth/send-login-link",{method:"POST",body:JSON.stringify({email:t,extId:r})})}}(a.API_BASE_URL)},{"../constants":"3KPcQ","../auth/tokenStorage":"95fXr","@plasmohq/storage":"luF8G","7383d526c0d9cb98":"7Zu6u",ea5d11c2ce00cba3:"j3T0f","@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],"3KPcQ":[function(e,t,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"API_BASE_URL",()=>a),r.export(s,"STRIPE_CUSTOMER_PORTAL_URL",()=>i),r.export(s,"STRIPE_SUCCESS_URL",()=>n),r.export(s,"STRIPE_CANCEL_URL",()=>o);let a="https://n8nchat.com/api",i="https://billing.stripe.com/p/login/5kA28SgEfg2g8nubII",n="https://n8nchat.com/payment/success",o="https://n8nchat.com/payment/cancel"},{"@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],"95fXr":[function(e,t,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"TokenStorage",()=>n);var a=e("@plasmohq/storage");let i=new a.Storage({area:"local"}),n={async setTokens(e,t){await i.set("accessToken",e),await i.set("refreshToken",t),await i.set("tokenTimestamp",Date.now())},async getTokens(){let e=await i.get("accessToken"),t=await i.get("refreshToken"),s=await i.get("tokenTimestamp");return{accessToken:e??null,refreshToken:t??null,tokenTimestamp:s||0}},async clearTokens(){await i.remove("accessToken"),await i.remove("refreshToken"),await i.remove("tokenTimestamp")},isTokenExpired(e){let t=Date.now();return t-e>3e6}}},{"@plasmohq/storage":"luF8G","@parcel/transformer-js/src/esmodule-helpers.js":"hbR2Q"}],"7Zu6u":[function(e,t,s){t.exports=e("f99d0600e1c93196")(e("ed224d5ba71a835d").getBundleURL("hQLIL")+e("75e4b5be390b6070").resolve("hQLIL")).then(()=>t.bundle.root("cjnrU"))},{f99d0600e1c93196:"kkv7s",ed224d5ba71a835d:"1Ksod","75e4b5be390b6070":"aOnzl"}],kkv7s:[function(e,t,s){var r=e("8cac51c89fd1baba");t.exports=r(function(e){return new Promise(function(t,s){try{importScripts(e),t()}catch(e){s(e)}})})},{"8cac51c89fd1baba":"dRtkF"}],dRtkF:[function(e,t,s){var r={},a={},i={};t.exports=function(e,t){return function(s){var n=function(e){switch(e){case"preload":return a;case"prefetch":return i;default:return r}}(t);return n[s]?n[s]:n[s]=e.apply(null,arguments).catch(function(e){throw delete n[s],e})}}},{}],"1Ksod":[function(e,t,s){var r={};function a(e){return(""+e).replace(/^((?:https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}s.getBundleURL=function(e){var t=r[e];return t||(t=function(){try{throw Error()}catch(t){var e=(""+t.stack).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^)\n]+/g);if(e)return a(e[2])}return"/"}(),r[e]=t),t},s.getBaseURL=a,s.getOrigin=function(e){var t=(""+e).match(/(https?|file|ftp|(chrome|moz|safari-web)-extension):\/\/[^/]+/);if(!t)throw Error("Origin not found");return t[0]}},{}],aOnzl:[function(e,t,s){var r={};t.exports.register=function(e){for(var t=Object.keys(e),s=0;s<t.length;s++)r[t[s]]=e[t[s]]},t.exports.resolve=function(e){var t=r[e];if(null==t)throw Error("Could not resolve bundle with id "+e);return t}},{}],j3T0f:[function(e,t,s){t.exports=e("7fa598a74dabb7b0")(e("3faf04c4adb87ef5").getBundleURL("hQLIL")+e("c8b5ba62ccfd0bd3").resolve("7vBBH")).then(()=>t.bundle.root("5Q82B"))},{"7fa598a74dabb7b0":"kkv7s","3faf04c4adb87ef5":"1Ksod",c8b5ba62ccfd0bd3:"aOnzl"}]},["cjnrU"],"cjnrU","parcelRequire6393"),globalThis.define=t;